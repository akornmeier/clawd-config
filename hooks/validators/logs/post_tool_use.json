[
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Bash",
    "tool_input": {
      "command": "cd /Users/tk/.claude/hooks/validators && ruff check *.py --fix 2>&1 || true",
      "description": "Run ruff lint check on Python validators"
    },
    "tool_response": {
      "stdout": "(eval):1: command not found: ruff",
      "stderr": "",
      "interrupted": false,
      "isImage": false
    },
    "tool_use_id": "toolu_01BMVaybBs9L4CLtaXqedJHR"
  },
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Bash",
    "tool_input": {
      "command": "cd /Users/tk/.claude/hooks/validators && python3 -m py_compile *.py && echo \"All Python files compile successfully\"",
      "description": "Verify Python syntax for all validators"
    },
    "tool_response": {
      "stdout": "All Python files compile successfully",
      "stderr": "",
      "interrupted": false,
      "isImage": false
    },
    "tool_use_id": "toolu_01X6scbwt4qGUSUqLco1Kt6A"
  },
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Read",
    "tool_input": {
      "file_path": "/Users/tk/Code/claude-code-hooks/AGENTS.md"
    },
    "tool_response": {
      "type": "text",
      "file": {
        "filePath": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
        "content": "# Claude Code Agents\n\nThis repository contains self-validating agents and orchestration patterns for Claude Code.\n\n## Quick Links\n\n- [Writing Agent Plans](docs/writing-agent-plans.md) - How to write effective orchestration plans\n- [Hook Validators](#hook-validators) - Quality gate implementations\n- [Shared Agents](#shared-agents) - User-level agents in `~/.claude/agents/`\n- [Project Agents](#project-agents) - Project-specific agents\n\n---\n\n## Layered Architecture\n\nThe system uses a **layered architecture** where user-level components provide the foundation, and project-level agents extend with domain-specific specializations.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  USER LEVEL (~/.claude/)                                     \u2502\n\u2502  Foundation shared across ALL projects                       \u2502\n\u2502                                                              \u2502\n\u2502  commands/                                                   \u2502\n\u2502  \u251c\u2500\u2500 plan.md              # /plan - Create team plans       \u2502\n\u2502  \u2514\u2500\u2500 build.md             # /build - Execute plans          \u2502\n\u2502                                                              \u2502\n\u2502  agents/                                                     \u2502\n\u2502  \u251c\u2500\u2500 tdd-builder.md       # TDD + lint + type + coverage    \u2502\n\u2502  \u251c\u2500\u2500 ts-builder.md        # Lint + type validation          \u2502\n\u2502  \u251c\u2500\u2500 ts-validator.md      # Read-only verification          \u2502\n\u2502  \u251c\u2500\u2500 turborepo-runner.md  # Monorepo commands               \u2502\n\u2502  \u251c\u2500\u2500 coverage-checker.md  # Coverage validation             \u2502\n\u2502  \u2514\u2500\u2500 team/                                                   \u2502\n\u2502      \u251c\u2500\u2500 builder.md       # Generic builder for /build      \u2502\n\u2502      \u2514\u2500\u2500 validator.md     # Generic validator for /build    \u2502\n\u2502                                                              \u2502\n\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193 extends\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECT LEVEL (~/code/<project>/.claude/)                   \u2502\n\u2502  Domain-specific agents that USE user-level validators       \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/stached/.claude/agents/                              \u2502\n\u2502  \u251c\u2500\u2500 convex-builder.md    # Convex + user validators        \u2502\n\u2502  \u251c\u2500\u2500 article-parser.md    # Domain knowledge only           \u2502\n\u2502  \u2514\u2500\u2500 extension-builder.md # WXT + user validators           \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/oculis/.claude/agents/                               \u2502\n\u2502  \u251c\u2500\u2500 axe-specialist.md    # A11y + user validators          \u2502\n\u2502  \u251c\u2500\u2500 adapter-guide.md     # Read-only guidance              \u2502\n\u2502  \u2514\u2500\u2500 tdd-builder.md       # TDD + Turborepo commands        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### How Project Agents Use User-Level Validators\n\nProject agents reference user-level validators via `~/.claude/hooks/validators/`:\n\n```yaml\n# ~/code/stached/.claude/agents/convex-builder.md\nhooks:\n  PostToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        # Project-specific validation\n        - type: command\n          command: pnpm --filter @stache/convex type-check\n        # User-level validator (reusable)\n        - type: command\n          command: uv run ~/.claude/hooks/validators/oxlint_validator.py\n```\n\nThis pattern allows:\n- **Shared foundation**: Common validators work everywhere\n- **Project specialization**: Add domain-specific commands\n- **Consistent quality**: Same lint/type/TDD rules across projects\n\n---\n\n## Self-Validating Agent Pattern\n\nThe core innovation is **self-validating agents** - agents that cannot complete work without passing quality gates:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SELF-VALIDATING AGENT                                       \u2502\n\u2502                                                              \u2502\n\u2502  Agent Definition (.md file)                                 \u2502\n\u2502  \u251c\u2500\u2500 System Prompt: What the agent does                      \u2502\n\u2502  \u251c\u2500\u2500 PreToolUse Hooks: Gates BEFORE action                   \u2502\n\u2502  \u2502   \u2514\u2500\u2500 TDD enforcer: Can't write impl without test         \u2502\n\u2502  \u251c\u2500\u2500 PostToolUse Hooks: Validates AFTER action               \u2502\n\u2502  \u2502   \u2514\u2500\u2500 Lint/Type validators: Can't proceed with errors     \u2502\n\u2502  \u2514\u2500\u2500 Stop Hooks: Final gate BEFORE completion                \u2502\n\u2502      \u2514\u2500\u2500 Coverage validator: Can't stop without 80%          \u2502\n\u2502                                                              \u2502\n\u2502  Result: Agent keeps working until ALL gates pass            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Two Layers of Validation\n\n| Layer | Purpose | Validators |\n|-------|---------|------------|\n| **Plan Validation** | Ensure plans have required structure | `validate_new_file.py`, `validate_file_contains.py` |\n| **Code Quality** | Ensure code meets engineering standards | `tdd_enforcer.py`, `oxlint_validator.py`, `tsc_validator.py`, `coverage_validator.py` |\n\n**Plan validators** ensure the orchestrating agent creates well-formed plans with required sections.\n**Code quality validators** ensure builder agents produce production-ready code.\n\n### Why This Matters\n\n> \"You want to be teaching your agents how to build like you would.\"\n\nThe difference between **agentic engineering** and **vibe coding** is knowing the outcome your agent will generate. Self-validating agents with templated plans create predictable, high-quality results.\n\n---\n\n## Hook Validators\n\n### TDD Enforcer (`tdd_enforcer.py`)\n**Event**: PreToolUse (Write|Edit|MultiEdit)\n\nBlocks implementation file writes until corresponding test file has been modified in the session.\n\n```python\n# Patterns matched as test files:\nsrc/foo.ts        \u2192 src/foo.test.ts, src/foo.spec.ts\nsrc/bar/Baz.tsx   \u2192 src/bar/Baz.test.tsx, src/bar/__tests__/Baz.test.tsx\n```\n\n### Session Start TDD (`session_start_tdd.py`)\n**Event**: SessionStart\n\nClears TDD session state, ensuring each session starts fresh.\n\n### OXLint Validator (`oxlint_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `pnpm exec oxlint` on TS/JS files. Blocks if lint errors found.\n\n### TSC Validator (`tsc_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `npx tsc --noEmit` on TypeScript files. Blocks if type errors found.\n\n### Coverage Validator (`coverage_validator.py`)\n**Event**: Stop\n\nRuns `pnpm test:coverage` and blocks if coverage < 80%.\n\n### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n---\n\n## UI Agents\n\nThe UI layer provides specialized agents for frontend development with design system knowledge.\n\n### User-Level UI Agents\n\n| Agent | Purpose |\n|-------|---------|\n| `ui-builder` | Generic React + Tailwind builder with Motion |\n| `ui-validator` | Read-only validation against design specs |\n\n### Project-Level UI Agents\n\n| Project | Agent | Stack |\n|---------|-------|-------|\n| Stached | `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n| Oculis | `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |\n\n### UI Validation Flow\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. PLANNING: Include design specs in task prompts          \u2502\n\u2502     - Reference component patterns                          \u2502\n\u2502     - Specify animation requirements                        \u2502\n\u2502     - Include accessibility criteria                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. BUILD: UI builder creates component                     \u2502\n\u2502     - PostToolUse: lint, types, storybook check             \u2502\n\u2502     - Creates component + stories + tests                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. VALIDATE: UI validator reviews implementation           \u2502\n\u2502     - Design compliance                                     \u2502\n\u2502     - Accessibility (WCAG AA)                               \u2502\n\u2502     - Component patterns                                    \u2502\n\u2502     - Flags issues for self-correction                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Shared Agents\n\n### `tdd-builder`\n**Model**: opus | **Color**: cyan\n\nThe flagship self-validating agent with all gates:\n- PreToolUse: TDD enforcement\n- PostToolUse: Lint + Type validation\n- Stop: Coverage threshold\n\nUse for disciplined TDD workflow.\n\n### `ts-builder`\n**Model**: opus | **Color**: blue\n\nStandard builder with quality validation:\n- PostToolUse: Lint + Type validation\n\nUse for general implementation without strict TDD.\n\n### `ts-validator`\n**Model**: sonnet | **Color**: yellow\n\nRead-only verification agent:\n- Disallowed: Write, Edit, MultiEdit, NotebookEdit\n\nUse after builder to verify work meets standards.\n\n### `turborepo-runner`\n**Model**: sonnet | **Color**: green\n\nMonorepo orchestration specialist:\n- Tools: Bash, Read, Glob\n\nUse for running commands across monorepo packages.\n\n### `coverage-checker`\n**Model**: haiku | **Color**: purple\n\nLightweight coverage validation:\n- Disallowed: Write, Edit\n\nUse to check coverage after tests pass.\n\n---\n\n## Project Agents\n\n### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n\n---\n\n## Usage\n\n### Invoking Agents via Task Tool\n\n```typescript\nTask({\n  description: \"Implement feature with TDD\",\n  prompt: \"Create user authentication with tests first\",\n  subagent_type: \"tdd-builder\",\n  model: \"opus\"\n})\n```\n\n### Orchestrating Multiple Agents\n\nSee [Writing Agent Plans](docs/writing-agent-plans.md) for the complete orchestration format.\n\n```markdown\n## Team Members\n\n- Builder\n  - Name: auth-builder\n  - Role: Implement authentication\n  - Agent Type: tdd-builder\n  - Resume: true\n\n- Validator\n  - Name: auth-validator\n  - Role: Verify auth implementation\n  - Agent Type: ts-validator\n  - Resume: true\n```\n\n---\n\n## Creating New Agents\n\n### Agent Definition Format\n\n```yaml\n---\nname: my-agent\ndescription: Action-oriented description for auto-delegation\nmodel: opus | sonnet | haiku\ncolor: red | blue | green | yellow | purple | orange | pink | cyan\ntools: Tool1, Tool2        # Optional: restrict tools\ndisallowedTools: Write     # Optional: deny tools\nhooks:\n  PreToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        - type: command\n          command: uv run ~/.claude/hooks/validators/my_validator.py\n  PostToolUse:\n    - matcher: \"Write\"\n      hooks:\n        - type: command\n          command: pnpm lint\n  Stop:\n    - hooks:\n        - type: command\n          command: pnpm test\n---\n\n# Agent Name\n\n## Purpose\nWhat this agent does and when to use it.\n\n## Instructions\nHow the agent should operate.\n\n## Report\nOutput format when task completes.\n```\n\n### Hook Output Format\n\nHooks must output JSON:\n\n```json\n// Allow the action\n{\"decision\": \"allow\"}\n\n// Block the action\n{\"decision\": \"block\", \"reason\": \"Explanation of why blocked\"}\n```\n\n---\n\n## Testing\n\n### Verify TDD Enforcer\n\n```bash\n# Should block (no test exists)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (it's a test file)\necho '{\"tool_input\": {\"file_path\": \"src/foo.test.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (test was recorded)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n```\n\n### Reset TDD State\n\n```bash\npython3 ~/.claude/hooks/validators/session_start_tdd.py\n```\n\n### Validate Python Syntax\n\n```bash\npython3 -m py_compile ~/.claude/hooks/validators/*.py\n```\n",
        "numLines": 393,
        "startLine": 1,
        "totalLines": 393
      }
    },
    "tool_use_id": "toolu_016pk4yuj8AzJ47PQzzriGC1"
  },
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Edit",
    "tool_input": {
      "file_path": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "old_string": "\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502",
      "new_string": "\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 storybook_validator.py # PostToolUse: stories exist    \u2502\n\u2502  \u251c\u2500\u2500 test_methodology_validator.py # PostToolUse: test separation \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502",
      "replace_all": false
    },
    "tool_response": {
      "filePath": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "oldString": "\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502",
      "newString": "\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 storybook_validator.py # PostToolUse: stories exist    \u2502\n\u2502  \u251c\u2500\u2500 test_methodology_validator.py # PostToolUse: test separation \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502",
      "originalFile": "# Claude Code Agents\n\nThis repository contains self-validating agents and orchestration patterns for Claude Code.\n\n## Quick Links\n\n- [Writing Agent Plans](docs/writing-agent-plans.md) - How to write effective orchestration plans\n- [Hook Validators](#hook-validators) - Quality gate implementations\n- [Shared Agents](#shared-agents) - User-level agents in `~/.claude/agents/`\n- [Project Agents](#project-agents) - Project-specific agents\n\n---\n\n## Layered Architecture\n\nThe system uses a **layered architecture** where user-level components provide the foundation, and project-level agents extend with domain-specific specializations.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  USER LEVEL (~/.claude/)                                     \u2502\n\u2502  Foundation shared across ALL projects                       \u2502\n\u2502                                                              \u2502\n\u2502  commands/                                                   \u2502\n\u2502  \u251c\u2500\u2500 plan.md              # /plan - Create team plans       \u2502\n\u2502  \u2514\u2500\u2500 build.md             # /build - Execute plans          \u2502\n\u2502                                                              \u2502\n\u2502  agents/                                                     \u2502\n\u2502  \u251c\u2500\u2500 tdd-builder.md       # TDD + lint + type + coverage    \u2502\n\u2502  \u251c\u2500\u2500 ts-builder.md        # Lint + type validation          \u2502\n\u2502  \u251c\u2500\u2500 ts-validator.md      # Read-only verification          \u2502\n\u2502  \u251c\u2500\u2500 turborepo-runner.md  # Monorepo commands               \u2502\n\u2502  \u251c\u2500\u2500 coverage-checker.md  # Coverage validation             \u2502\n\u2502  \u2514\u2500\u2500 team/                                                   \u2502\n\u2502      \u251c\u2500\u2500 builder.md       # Generic builder for /build      \u2502\n\u2502      \u2514\u2500\u2500 validator.md     # Generic validator for /build    \u2502\n\u2502                                                              \u2502\n\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193 extends\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECT LEVEL (~/code/<project>/.claude/)                   \u2502\n\u2502  Domain-specific agents that USE user-level validators       \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/stached/.claude/agents/                              \u2502\n\u2502  \u251c\u2500\u2500 convex-builder.md    # Convex + user validators        \u2502\n\u2502  \u251c\u2500\u2500 article-parser.md    # Domain knowledge only           \u2502\n\u2502  \u2514\u2500\u2500 extension-builder.md # WXT + user validators           \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/oculis/.claude/agents/                               \u2502\n\u2502  \u251c\u2500\u2500 axe-specialist.md    # A11y + user validators          \u2502\n\u2502  \u251c\u2500\u2500 adapter-guide.md     # Read-only guidance              \u2502\n\u2502  \u2514\u2500\u2500 tdd-builder.md       # TDD + Turborepo commands        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### How Project Agents Use User-Level Validators\n\nProject agents reference user-level validators via `~/.claude/hooks/validators/`:\n\n```yaml\n# ~/code/stached/.claude/agents/convex-builder.md\nhooks:\n  PostToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        # Project-specific validation\n        - type: command\n          command: pnpm --filter @stache/convex type-check\n        # User-level validator (reusable)\n        - type: command\n          command: uv run ~/.claude/hooks/validators/oxlint_validator.py\n```\n\nThis pattern allows:\n- **Shared foundation**: Common validators work everywhere\n- **Project specialization**: Add domain-specific commands\n- **Consistent quality**: Same lint/type/TDD rules across projects\n\n---\n\n## Self-Validating Agent Pattern\n\nThe core innovation is **self-validating agents** - agents that cannot complete work without passing quality gates:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SELF-VALIDATING AGENT                                       \u2502\n\u2502                                                              \u2502\n\u2502  Agent Definition (.md file)                                 \u2502\n\u2502  \u251c\u2500\u2500 System Prompt: What the agent does                      \u2502\n\u2502  \u251c\u2500\u2500 PreToolUse Hooks: Gates BEFORE action                   \u2502\n\u2502  \u2502   \u2514\u2500\u2500 TDD enforcer: Can't write impl without test         \u2502\n\u2502  \u251c\u2500\u2500 PostToolUse Hooks: Validates AFTER action               \u2502\n\u2502  \u2502   \u2514\u2500\u2500 Lint/Type validators: Can't proceed with errors     \u2502\n\u2502  \u2514\u2500\u2500 Stop Hooks: Final gate BEFORE completion                \u2502\n\u2502      \u2514\u2500\u2500 Coverage validator: Can't stop without 80%          \u2502\n\u2502                                                              \u2502\n\u2502  Result: Agent keeps working until ALL gates pass            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Two Layers of Validation\n\n| Layer | Purpose | Validators |\n|-------|---------|------------|\n| **Plan Validation** | Ensure plans have required structure | `validate_new_file.py`, `validate_file_contains.py` |\n| **Code Quality** | Ensure code meets engineering standards | `tdd_enforcer.py`, `oxlint_validator.py`, `tsc_validator.py`, `coverage_validator.py` |\n\n**Plan validators** ensure the orchestrating agent creates well-formed plans with required sections.\n**Code quality validators** ensure builder agents produce production-ready code.\n\n### Why This Matters\n\n> \"You want to be teaching your agents how to build like you would.\"\n\nThe difference between **agentic engineering** and **vibe coding** is knowing the outcome your agent will generate. Self-validating agents with templated plans create predictable, high-quality results.\n\n---\n\n## Hook Validators\n\n### TDD Enforcer (`tdd_enforcer.py`)\n**Event**: PreToolUse (Write|Edit|MultiEdit)\n\nBlocks implementation file writes until corresponding test file has been modified in the session.\n\n```python\n# Patterns matched as test files:\nsrc/foo.ts        \u2192 src/foo.test.ts, src/foo.spec.ts\nsrc/bar/Baz.tsx   \u2192 src/bar/Baz.test.tsx, src/bar/__tests__/Baz.test.tsx\n```\n\n### Session Start TDD (`session_start_tdd.py`)\n**Event**: SessionStart\n\nClears TDD session state, ensuring each session starts fresh.\n\n### OXLint Validator (`oxlint_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `pnpm exec oxlint` on TS/JS files. Blocks if lint errors found.\n\n### TSC Validator (`tsc_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `npx tsc --noEmit` on TypeScript files. Blocks if type errors found.\n\n### Coverage Validator (`coverage_validator.py`)\n**Event**: Stop\n\nRuns `pnpm test:coverage` and blocks if coverage < 80%.\n\n### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n---\n\n## UI Agents\n\nThe UI layer provides specialized agents for frontend development with design system knowledge.\n\n### User-Level UI Agents\n\n| Agent | Purpose |\n|-------|---------|\n| `ui-builder` | Generic React + Tailwind builder with Motion |\n| `ui-validator` | Read-only validation against design specs |\n\n### Project-Level UI Agents\n\n| Project | Agent | Stack |\n|---------|-------|-------|\n| Stached | `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n| Oculis | `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |\n\n### UI Validation Flow\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. PLANNING: Include design specs in task prompts          \u2502\n\u2502     - Reference component patterns                          \u2502\n\u2502     - Specify animation requirements                        \u2502\n\u2502     - Include accessibility criteria                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. BUILD: UI builder creates component                     \u2502\n\u2502     - PostToolUse: lint, types, storybook check             \u2502\n\u2502     - Creates component + stories + tests                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. VALIDATE: UI validator reviews implementation           \u2502\n\u2502     - Design compliance                                     \u2502\n\u2502     - Accessibility (WCAG AA)                               \u2502\n\u2502     - Component patterns                                    \u2502\n\u2502     - Flags issues for self-correction                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Shared Agents\n\n### `tdd-builder`\n**Model**: opus | **Color**: cyan\n\nThe flagship self-validating agent with all gates:\n- PreToolUse: TDD enforcement\n- PostToolUse: Lint + Type validation\n- Stop: Coverage threshold\n\nUse for disciplined TDD workflow.\n\n### `ts-builder`\n**Model**: opus | **Color**: blue\n\nStandard builder with quality validation:\n- PostToolUse: Lint + Type validation\n\nUse for general implementation without strict TDD.\n\n### `ts-validator`\n**Model**: sonnet | **Color**: yellow\n\nRead-only verification agent:\n- Disallowed: Write, Edit, MultiEdit, NotebookEdit\n\nUse after builder to verify work meets standards.\n\n### `turborepo-runner`\n**Model**: sonnet | **Color**: green\n\nMonorepo orchestration specialist:\n- Tools: Bash, Read, Glob\n\nUse for running commands across monorepo packages.\n\n### `coverage-checker`\n**Model**: haiku | **Color**: purple\n\nLightweight coverage validation:\n- Disallowed: Write, Edit\n\nUse to check coverage after tests pass.\n\n---\n\n## Project Agents\n\n### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n\n---\n\n## Usage\n\n### Invoking Agents via Task Tool\n\n```typescript\nTask({\n  description: \"Implement feature with TDD\",\n  prompt: \"Create user authentication with tests first\",\n  subagent_type: \"tdd-builder\",\n  model: \"opus\"\n})\n```\n\n### Orchestrating Multiple Agents\n\nSee [Writing Agent Plans](docs/writing-agent-plans.md) for the complete orchestration format.\n\n```markdown\n## Team Members\n\n- Builder\n  - Name: auth-builder\n  - Role: Implement authentication\n  - Agent Type: tdd-builder\n  - Resume: true\n\n- Validator\n  - Name: auth-validator\n  - Role: Verify auth implementation\n  - Agent Type: ts-validator\n  - Resume: true\n```\n\n---\n\n## Creating New Agents\n\n### Agent Definition Format\n\n```yaml\n---\nname: my-agent\ndescription: Action-oriented description for auto-delegation\nmodel: opus | sonnet | haiku\ncolor: red | blue | green | yellow | purple | orange | pink | cyan\ntools: Tool1, Tool2        # Optional: restrict tools\ndisallowedTools: Write     # Optional: deny tools\nhooks:\n  PreToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        - type: command\n          command: uv run ~/.claude/hooks/validators/my_validator.py\n  PostToolUse:\n    - matcher: \"Write\"\n      hooks:\n        - type: command\n          command: pnpm lint\n  Stop:\n    - hooks:\n        - type: command\n          command: pnpm test\n---\n\n# Agent Name\n\n## Purpose\nWhat this agent does and when to use it.\n\n## Instructions\nHow the agent should operate.\n\n## Report\nOutput format when task completes.\n```\n\n### Hook Output Format\n\nHooks must output JSON:\n\n```json\n// Allow the action\n{\"decision\": \"allow\"}\n\n// Block the action\n{\"decision\": \"block\", \"reason\": \"Explanation of why blocked\"}\n```\n\n---\n\n## Testing\n\n### Verify TDD Enforcer\n\n```bash\n# Should block (no test exists)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (it's a test file)\necho '{\"tool_input\": {\"file_path\": \"src/foo.test.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (test was recorded)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n```\n\n### Reset TDD State\n\n```bash\npython3 ~/.claude/hooks/validators/session_start_tdd.py\n```\n\n### Validate Python Syntax\n\n```bash\npython3 -m py_compile ~/.claude/hooks/validators/*.py\n```\n",
      "structuredPatch": [
        {
          "oldStart": 39,
          "oldLines": 6,
          "newStart": 39,
          "newLines": 8,
          "lines": [
            " \u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502",
            " \u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502",
            " \u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502",
            "+\u2502  \u251c\u2500\u2500 storybook_validator.py # PostToolUse: stories exist    \u2502",
            "+\u2502  \u251c\u2500\u2500 test_methodology_validator.py # PostToolUse: test separation \u2502",
            " \u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502",
            " \u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502",
            " \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518"
          ]
        }
      ],
      "userModified": false,
      "replaceAll": false
    },
    "tool_use_id": "toolu_01LGT7UpbxAJt9r9VP1nVPWX"
  },
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Edit",
    "tool_input": {
      "file_path": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "old_string": "### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n---\n\n## UI Agents",
      "new_string": "### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n### Test Methodology Validator (`test_methodology_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nValidates proper test separation between unit tests and interaction tests:\n- Unit tests (`.test.tsx`) for structure/rendering\n- Storybook play functions for user interactions\n\nWarns if story files lack play functions or if unit test files are missing.\n\n---\n\n## Testing Methodology\n\nA critical distinction for UI agents: **unit tests** and **interaction tests** serve different purposes and use different tools.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UNIT TESTS (.test.tsx / .test.ts)                          \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test component STRUCTURE and RENDERING        \u2502\n\u2502  \u251c\u2500\u2500 Tool: Vitest + Testing Library                         \u2502\n\u2502  \u251c\u2500\u2500 Environment: jsdom (fast, limited)                     \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Renders without errors                             \u2502\n\u2502      \u251c\u2500\u2500 Props applied correctly                            \u2502\n\u2502      \u251c\u2500\u2500 Variant classes present                            \u2502\n\u2502      \u2514\u2500\u2500 Accessibility attributes (roles, aria-*)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STORYBOOK INTERACTION TESTS (play functions)               \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test USER INTERACTIONS in real browser        \u2502\n\u2502  \u251c\u2500\u2500 Tool: storybook/test (userEvent, within, expect)       \u2502\n\u2502  \u251c\u2500\u2500 Environment: Real browser via Playwright               \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Click interactions                                 \u2502\n\u2502      \u251c\u2500\u2500 Keyboard navigation                                \u2502\n\u2502      \u251c\u2500\u2500 Focus management                                   \u2502\n\u2502      \u2514\u2500\u2500 State changes (expanded, selected, etc.)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n**Why This Matters**: Unit tests run in jsdom which has limitations with real browser behavior. Storybook play functions run in a REAL BROWSER via Playwright, catching issues unit tests miss.\n\n### Test File Mapping\n\n| Test Type | File Pattern | What to Test |\n|-----------|--------------|--------------|\n| Unit | `Component.test.tsx` | Rendering, classes, props, DOM structure |\n| Interaction | `Component.stories.tsx` (play) | Clicks, keyboard, focus, state changes |\n\n---\n\n## UI Agents",
      "replace_all": false
    },
    "tool_response": {
      "filePath": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "oldString": "### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n---\n\n## UI Agents",
      "newString": "### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n### Test Methodology Validator (`test_methodology_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nValidates proper test separation between unit tests and interaction tests:\n- Unit tests (`.test.tsx`) for structure/rendering\n- Storybook play functions for user interactions\n\nWarns if story files lack play functions or if unit test files are missing.\n\n---\n\n## Testing Methodology\n\nA critical distinction for UI agents: **unit tests** and **interaction tests** serve different purposes and use different tools.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UNIT TESTS (.test.tsx / .test.ts)                          \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test component STRUCTURE and RENDERING        \u2502\n\u2502  \u251c\u2500\u2500 Tool: Vitest + Testing Library                         \u2502\n\u2502  \u251c\u2500\u2500 Environment: jsdom (fast, limited)                     \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Renders without errors                             \u2502\n\u2502      \u251c\u2500\u2500 Props applied correctly                            \u2502\n\u2502      \u251c\u2500\u2500 Variant classes present                            \u2502\n\u2502      \u2514\u2500\u2500 Accessibility attributes (roles, aria-*)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STORYBOOK INTERACTION TESTS (play functions)               \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test USER INTERACTIONS in real browser        \u2502\n\u2502  \u251c\u2500\u2500 Tool: storybook/test (userEvent, within, expect)       \u2502\n\u2502  \u251c\u2500\u2500 Environment: Real browser via Playwright               \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Click interactions                                 \u2502\n\u2502      \u251c\u2500\u2500 Keyboard navigation                                \u2502\n\u2502      \u251c\u2500\u2500 Focus management                                   \u2502\n\u2502      \u2514\u2500\u2500 State changes (expanded, selected, etc.)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n**Why This Matters**: Unit tests run in jsdom which has limitations with real browser behavior. Storybook play functions run in a REAL BROWSER via Playwright, catching issues unit tests miss.\n\n### Test File Mapping\n\n| Test Type | File Pattern | What to Test |\n|-----------|--------------|--------------|\n| Unit | `Component.test.tsx` | Rendering, classes, props, DOM structure |\n| Interaction | `Component.stories.tsx` (play) | Clicks, keyboard, focus, state changes |\n\n---\n\n## UI Agents",
      "originalFile": "# Claude Code Agents\n\nThis repository contains self-validating agents and orchestration patterns for Claude Code.\n\n## Quick Links\n\n- [Writing Agent Plans](docs/writing-agent-plans.md) - How to write effective orchestration plans\n- [Hook Validators](#hook-validators) - Quality gate implementations\n- [Shared Agents](#shared-agents) - User-level agents in `~/.claude/agents/`\n- [Project Agents](#project-agents) - Project-specific agents\n\n---\n\n## Layered Architecture\n\nThe system uses a **layered architecture** where user-level components provide the foundation, and project-level agents extend with domain-specific specializations.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  USER LEVEL (~/.claude/)                                     \u2502\n\u2502  Foundation shared across ALL projects                       \u2502\n\u2502                                                              \u2502\n\u2502  commands/                                                   \u2502\n\u2502  \u251c\u2500\u2500 plan.md              # /plan - Create team plans       \u2502\n\u2502  \u2514\u2500\u2500 build.md             # /build - Execute plans          \u2502\n\u2502                                                              \u2502\n\u2502  agents/                                                     \u2502\n\u2502  \u251c\u2500\u2500 tdd-builder.md       # TDD + lint + type + coverage    \u2502\n\u2502  \u251c\u2500\u2500 ts-builder.md        # Lint + type validation          \u2502\n\u2502  \u251c\u2500\u2500 ts-validator.md      # Read-only verification          \u2502\n\u2502  \u251c\u2500\u2500 turborepo-runner.md  # Monorepo commands               \u2502\n\u2502  \u251c\u2500\u2500 coverage-checker.md  # Coverage validation             \u2502\n\u2502  \u2514\u2500\u2500 team/                                                   \u2502\n\u2502      \u251c\u2500\u2500 builder.md       # Generic builder for /build      \u2502\n\u2502      \u2514\u2500\u2500 validator.md     # Generic validator for /build    \u2502\n\u2502                                                              \u2502\n\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 storybook_validator.py # PostToolUse: stories exist    \u2502\n\u2502  \u251c\u2500\u2500 test_methodology_validator.py # PostToolUse: test separation \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193 extends\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECT LEVEL (~/code/<project>/.claude/)                   \u2502\n\u2502  Domain-specific agents that USE user-level validators       \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/stached/.claude/agents/                              \u2502\n\u2502  \u251c\u2500\u2500 convex-builder.md    # Convex + user validators        \u2502\n\u2502  \u251c\u2500\u2500 article-parser.md    # Domain knowledge only           \u2502\n\u2502  \u2514\u2500\u2500 extension-builder.md # WXT + user validators           \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/oculis/.claude/agents/                               \u2502\n\u2502  \u251c\u2500\u2500 axe-specialist.md    # A11y + user validators          \u2502\n\u2502  \u251c\u2500\u2500 adapter-guide.md     # Read-only guidance              \u2502\n\u2502  \u2514\u2500\u2500 tdd-builder.md       # TDD + Turborepo commands        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### How Project Agents Use User-Level Validators\n\nProject agents reference user-level validators via `~/.claude/hooks/validators/`:\n\n```yaml\n# ~/code/stached/.claude/agents/convex-builder.md\nhooks:\n  PostToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        # Project-specific validation\n        - type: command\n          command: pnpm --filter @stache/convex type-check\n        # User-level validator (reusable)\n        - type: command\n          command: uv run ~/.claude/hooks/validators/oxlint_validator.py\n```\n\nThis pattern allows:\n- **Shared foundation**: Common validators work everywhere\n- **Project specialization**: Add domain-specific commands\n- **Consistent quality**: Same lint/type/TDD rules across projects\n\n---\n\n## Self-Validating Agent Pattern\n\nThe core innovation is **self-validating agents** - agents that cannot complete work without passing quality gates:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SELF-VALIDATING AGENT                                       \u2502\n\u2502                                                              \u2502\n\u2502  Agent Definition (.md file)                                 \u2502\n\u2502  \u251c\u2500\u2500 System Prompt: What the agent does                      \u2502\n\u2502  \u251c\u2500\u2500 PreToolUse Hooks: Gates BEFORE action                   \u2502\n\u2502  \u2502   \u2514\u2500\u2500 TDD enforcer: Can't write impl without test         \u2502\n\u2502  \u251c\u2500\u2500 PostToolUse Hooks: Validates AFTER action               \u2502\n\u2502  \u2502   \u2514\u2500\u2500 Lint/Type validators: Can't proceed with errors     \u2502\n\u2502  \u2514\u2500\u2500 Stop Hooks: Final gate BEFORE completion                \u2502\n\u2502      \u2514\u2500\u2500 Coverage validator: Can't stop without 80%          \u2502\n\u2502                                                              \u2502\n\u2502  Result: Agent keeps working until ALL gates pass            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Two Layers of Validation\n\n| Layer | Purpose | Validators |\n|-------|---------|------------|\n| **Plan Validation** | Ensure plans have required structure | `validate_new_file.py`, `validate_file_contains.py` |\n| **Code Quality** | Ensure code meets engineering standards | `tdd_enforcer.py`, `oxlint_validator.py`, `tsc_validator.py`, `coverage_validator.py` |\n\n**Plan validators** ensure the orchestrating agent creates well-formed plans with required sections.\n**Code quality validators** ensure builder agents produce production-ready code.\n\n### Why This Matters\n\n> \"You want to be teaching your agents how to build like you would.\"\n\nThe difference between **agentic engineering** and **vibe coding** is knowing the outcome your agent will generate. Self-validating agents with templated plans create predictable, high-quality results.\n\n---\n\n## Hook Validators\n\n### TDD Enforcer (`tdd_enforcer.py`)\n**Event**: PreToolUse (Write|Edit|MultiEdit)\n\nBlocks implementation file writes until corresponding test file has been modified in the session.\n\n```python\n# Patterns matched as test files:\nsrc/foo.ts        \u2192 src/foo.test.ts, src/foo.spec.ts\nsrc/bar/Baz.tsx   \u2192 src/bar/Baz.test.tsx, src/bar/__tests__/Baz.test.tsx\n```\n\n### Session Start TDD (`session_start_tdd.py`)\n**Event**: SessionStart\n\nClears TDD session state, ensuring each session starts fresh.\n\n### OXLint Validator (`oxlint_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `pnpm exec oxlint` on TS/JS files. Blocks if lint errors found.\n\n### TSC Validator (`tsc_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `npx tsc --noEmit` on TypeScript files. Blocks if type errors found.\n\n### Coverage Validator (`coverage_validator.py`)\n**Event**: Stop\n\nRuns `pnpm test:coverage` and blocks if coverage < 80%.\n\n### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n---\n\n## UI Agents\n\nThe UI layer provides specialized agents for frontend development with design system knowledge.\n\n### User-Level UI Agents\n\n| Agent | Purpose |\n|-------|---------|\n| `ui-builder` | Generic React + Tailwind builder with Motion |\n| `ui-validator` | Read-only validation against design specs |\n\n### Project-Level UI Agents\n\n| Project | Agent | Stack |\n|---------|-------|-------|\n| Stached | `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n| Oculis | `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |\n\n### UI Validation Flow\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. PLANNING: Include design specs in task prompts          \u2502\n\u2502     - Reference component patterns                          \u2502\n\u2502     - Specify animation requirements                        \u2502\n\u2502     - Include accessibility criteria                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. BUILD: UI builder creates component                     \u2502\n\u2502     - PostToolUse: lint, types, storybook check             \u2502\n\u2502     - Creates component + stories + tests                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. VALIDATE: UI validator reviews implementation           \u2502\n\u2502     - Design compliance                                     \u2502\n\u2502     - Accessibility (WCAG AA)                               \u2502\n\u2502     - Component patterns                                    \u2502\n\u2502     - Flags issues for self-correction                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Shared Agents\n\n### `tdd-builder`\n**Model**: opus | **Color**: cyan\n\nThe flagship self-validating agent with all gates:\n- PreToolUse: TDD enforcement\n- PostToolUse: Lint + Type validation\n- Stop: Coverage threshold\n\nUse for disciplined TDD workflow.\n\n### `ts-builder`\n**Model**: opus | **Color**: blue\n\nStandard builder with quality validation:\n- PostToolUse: Lint + Type validation\n\nUse for general implementation without strict TDD.\n\n### `ts-validator`\n**Model**: sonnet | **Color**: yellow\n\nRead-only verification agent:\n- Disallowed: Write, Edit, MultiEdit, NotebookEdit\n\nUse after builder to verify work meets standards.\n\n### `turborepo-runner`\n**Model**: sonnet | **Color**: green\n\nMonorepo orchestration specialist:\n- Tools: Bash, Read, Glob\n\nUse for running commands across monorepo packages.\n\n### `coverage-checker`\n**Model**: haiku | **Color**: purple\n\nLightweight coverage validation:\n- Disallowed: Write, Edit\n\nUse to check coverage after tests pass.\n\n---\n\n## Project Agents\n\n### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n\n---\n\n## Usage\n\n### Invoking Agents via Task Tool\n\n```typescript\nTask({\n  description: \"Implement feature with TDD\",\n  prompt: \"Create user authentication with tests first\",\n  subagent_type: \"tdd-builder\",\n  model: \"opus\"\n})\n```\n\n### Orchestrating Multiple Agents\n\nSee [Writing Agent Plans](docs/writing-agent-plans.md) for the complete orchestration format.\n\n```markdown\n## Team Members\n\n- Builder\n  - Name: auth-builder\n  - Role: Implement authentication\n  - Agent Type: tdd-builder\n  - Resume: true\n\n- Validator\n  - Name: auth-validator\n  - Role: Verify auth implementation\n  - Agent Type: ts-validator\n  - Resume: true\n```\n\n---\n\n## Creating New Agents\n\n### Agent Definition Format\n\n```yaml\n---\nname: my-agent\ndescription: Action-oriented description for auto-delegation\nmodel: opus | sonnet | haiku\ncolor: red | blue | green | yellow | purple | orange | pink | cyan\ntools: Tool1, Tool2        # Optional: restrict tools\ndisallowedTools: Write     # Optional: deny tools\nhooks:\n  PreToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        - type: command\n          command: uv run ~/.claude/hooks/validators/my_validator.py\n  PostToolUse:\n    - matcher: \"Write\"\n      hooks:\n        - type: command\n          command: pnpm lint\n  Stop:\n    - hooks:\n        - type: command\n          command: pnpm test\n---\n\n# Agent Name\n\n## Purpose\nWhat this agent does and when to use it.\n\n## Instructions\nHow the agent should operate.\n\n## Report\nOutput format when task completes.\n```\n\n### Hook Output Format\n\nHooks must output JSON:\n\n```json\n// Allow the action\n{\"decision\": \"allow\"}\n\n// Block the action\n{\"decision\": \"block\", \"reason\": \"Explanation of why blocked\"}\n```\n\n---\n\n## Testing\n\n### Verify TDD Enforcer\n\n```bash\n# Should block (no test exists)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (it's a test file)\necho '{\"tool_input\": {\"file_path\": \"src/foo.test.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (test was recorded)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n```\n\n### Reset TDD State\n\n```bash\npython3 ~/.claude/hooks/validators/session_start_tdd.py\n```\n\n### Validate Python Syntax\n\n```bash\npython3 -m py_compile ~/.claude/hooks/validators/*.py\n```\n",
      "structuredPatch": [
        {
          "oldStart": 163,
          "oldLines": 8,
          "newStart": 163,
          "newLines": 58,
          "lines": [
            " ",
            " Checks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.",
            " ",
            "+### Test Methodology Validator (`test_methodology_validator.py`)",
            "+**Event**: PostToolUse (Write|Edit)",
            "+",
            "+Validates proper test separation between unit tests and interaction tests:",
            "+- Unit tests (`.test.tsx`) for structure/rendering",
            "+- Storybook play functions for user interactions",
            "+",
            "+Warns if story files lack play functions or if unit test files are missing.",
            "+",
            " ---",
            " ",
            "+## Testing Methodology",
            "+",
            "+A critical distinction for UI agents: **unit tests** and **interaction tests** serve different purposes and use different tools.",
            "+",
            "+```",
            "+\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510",
            "+\u2502  UNIT TESTS (.test.tsx / .test.ts)                          \u2502",
            "+\u2502  \u251c\u2500\u2500 Purpose: Test component STRUCTURE and RENDERING        \u2502",
            "+\u2502  \u251c\u2500\u2500 Tool: Vitest + Testing Library                         \u2502",
            "+\u2502  \u251c\u2500\u2500 Environment: jsdom (fast, limited)                     \u2502",
            "+\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502",
            "+\u2502      \u251c\u2500\u2500 Renders without errors                             \u2502",
            "+\u2502      \u251c\u2500\u2500 Props applied correctly                            \u2502",
            "+\u2502      \u251c\u2500\u2500 Variant classes present                            \u2502",
            "+\u2502      \u2514\u2500\u2500 Accessibility attributes (roles, aria-*)           \u2502",
            "+\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518",
            "+",
            "+\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510",
            "+\u2502  STORYBOOK INTERACTION TESTS (play functions)               \u2502",
            "+\u2502  \u251c\u2500\u2500 Purpose: Test USER INTERACTIONS in real browser        \u2502",
            "+\u2502  \u251c\u2500\u2500 Tool: storybook/test (userEvent, within, expect)       \u2502",
            "+\u2502  \u251c\u2500\u2500 Environment: Real browser via Playwright               \u2502",
            "+\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502",
            "+\u2502      \u251c\u2500\u2500 Click interactions                                 \u2502",
            "+\u2502      \u251c\u2500\u2500 Keyboard navigation                                \u2502",
            "+\u2502      \u251c\u2500\u2500 Focus management                                   \u2502",
            "+\u2502      \u2514\u2500\u2500 State changes (expanded, selected, etc.)           \u2502",
            "+\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518",
            "+```",
            "+",
            "+**Why This Matters**: Unit tests run in jsdom which has limitations with real browser behavior. Storybook play functions run in a REAL BROWSER via Playwright, catching issues unit tests miss.",
            "+",
            "+### Test File Mapping",
            "+",
            "+| Test Type | File Pattern | What to Test |",
            "+|-----------|--------------|--------------|",
            "+| Unit | `Component.test.tsx` | Rendering, classes, props, DOM structure |",
            "+| Interaction | `Component.stories.tsx` (play) | Clicks, keyboard, focus, state changes |",
            "+",
            "+---",
            "+",
            " ## UI Agents",
            " ",
            " The UI layer provides specialized agents for frontend development with design system knowledge."
          ]
        }
      ],
      "userModified": false,
      "replaceAll": false
    },
    "tool_use_id": "toolu_01PM76ZqevtJY2TYwTxQsL72"
  },
  {
    "session_id": "eaa52d87-e744-4761-aebe-d9ff661c05f9",
    "transcript_path": "/Users/tk/.claude/projects/-Users-tk-Code-claude-code-hooks/eaa52d87-e744-4761-aebe-d9ff661c05f9.jsonl",
    "cwd": "/Users/tk/.claude/hooks/validators",
    "permission_mode": "acceptEdits",
    "hook_event_name": "PostToolUse",
    "tool_name": "Edit",
    "tool_input": {
      "file_path": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "old_string": "### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |",
      "new_string": "### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n| `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n| `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |",
      "replace_all": false
    },
    "tool_response": {
      "filePath": "/Users/tk/Code/claude-code-hooks/AGENTS.md",
      "oldString": "### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |",
      "newString": "### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n| `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n| `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |",
      "originalFile": "# Claude Code Agents\n\nThis repository contains self-validating agents and orchestration patterns for Claude Code.\n\n## Quick Links\n\n- [Writing Agent Plans](docs/writing-agent-plans.md) - How to write effective orchestration plans\n- [Hook Validators](#hook-validators) - Quality gate implementations\n- [Shared Agents](#shared-agents) - User-level agents in `~/.claude/agents/`\n- [Project Agents](#project-agents) - Project-specific agents\n\n---\n\n## Layered Architecture\n\nThe system uses a **layered architecture** where user-level components provide the foundation, and project-level agents extend with domain-specific specializations.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  USER LEVEL (~/.claude/)                                     \u2502\n\u2502  Foundation shared across ALL projects                       \u2502\n\u2502                                                              \u2502\n\u2502  commands/                                                   \u2502\n\u2502  \u251c\u2500\u2500 plan.md              # /plan - Create team plans       \u2502\n\u2502  \u2514\u2500\u2500 build.md             # /build - Execute plans          \u2502\n\u2502                                                              \u2502\n\u2502  agents/                                                     \u2502\n\u2502  \u251c\u2500\u2500 tdd-builder.md       # TDD + lint + type + coverage    \u2502\n\u2502  \u251c\u2500\u2500 ts-builder.md        # Lint + type validation          \u2502\n\u2502  \u251c\u2500\u2500 ts-validator.md      # Read-only verification          \u2502\n\u2502  \u251c\u2500\u2500 turborepo-runner.md  # Monorepo commands               \u2502\n\u2502  \u251c\u2500\u2500 coverage-checker.md  # Coverage validation             \u2502\n\u2502  \u2514\u2500\u2500 team/                                                   \u2502\n\u2502      \u251c\u2500\u2500 builder.md       # Generic builder for /build      \u2502\n\u2502      \u2514\u2500\u2500 validator.md     # Generic validator for /build    \u2502\n\u2502                                                              \u2502\n\u2502  hooks/validators/        # Reusable validation scripts     \u2502\n\u2502  \u251c\u2500\u2500 tdd_enforcer.py      # PreToolUse: test-first          \u2502\n\u2502  \u251c\u2500\u2500 oxlint_validator.py  # PostToolUse: lint               \u2502\n\u2502  \u251c\u2500\u2500 tsc_validator.py     # PostToolUse: types              \u2502\n\u2502  \u251c\u2500\u2500 coverage_validator.py # Stop: coverage threshold       \u2502\n\u2502  \u251c\u2500\u2500 storybook_validator.py # PostToolUse: stories exist    \u2502\n\u2502  \u251c\u2500\u2500 test_methodology_validator.py # PostToolUse: test separation \u2502\n\u2502  \u251c\u2500\u2500 validate_new_file.py  # Stop: plan file created        \u2502\n\u2502  \u2514\u2500\u2500 validate_file_contains.py # Stop: plan sections        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193 extends\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  PROJECT LEVEL (~/code/<project>/.claude/)                   \u2502\n\u2502  Domain-specific agents that USE user-level validators       \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/stached/.claude/agents/                              \u2502\n\u2502  \u251c\u2500\u2500 convex-builder.md    # Convex + user validators        \u2502\n\u2502  \u251c\u2500\u2500 article-parser.md    # Domain knowledge only           \u2502\n\u2502  \u2514\u2500\u2500 extension-builder.md # WXT + user validators           \u2502\n\u2502                                                              \u2502\n\u2502  ~/code/oculis/.claude/agents/                               \u2502\n\u2502  \u251c\u2500\u2500 axe-specialist.md    # A11y + user validators          \u2502\n\u2502  \u251c\u2500\u2500 adapter-guide.md     # Read-only guidance              \u2502\n\u2502  \u2514\u2500\u2500 tdd-builder.md       # TDD + Turborepo commands        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### How Project Agents Use User-Level Validators\n\nProject agents reference user-level validators via `~/.claude/hooks/validators/`:\n\n```yaml\n# ~/code/stached/.claude/agents/convex-builder.md\nhooks:\n  PostToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        # Project-specific validation\n        - type: command\n          command: pnpm --filter @stache/convex type-check\n        # User-level validator (reusable)\n        - type: command\n          command: uv run ~/.claude/hooks/validators/oxlint_validator.py\n```\n\nThis pattern allows:\n- **Shared foundation**: Common validators work everywhere\n- **Project specialization**: Add domain-specific commands\n- **Consistent quality**: Same lint/type/TDD rules across projects\n\n---\n\n## Self-Validating Agent Pattern\n\nThe core innovation is **self-validating agents** - agents that cannot complete work without passing quality gates:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  SELF-VALIDATING AGENT                                       \u2502\n\u2502                                                              \u2502\n\u2502  Agent Definition (.md file)                                 \u2502\n\u2502  \u251c\u2500\u2500 System Prompt: What the agent does                      \u2502\n\u2502  \u251c\u2500\u2500 PreToolUse Hooks: Gates BEFORE action                   \u2502\n\u2502  \u2502   \u2514\u2500\u2500 TDD enforcer: Can't write impl without test         \u2502\n\u2502  \u251c\u2500\u2500 PostToolUse Hooks: Validates AFTER action               \u2502\n\u2502  \u2502   \u2514\u2500\u2500 Lint/Type validators: Can't proceed with errors     \u2502\n\u2502  \u2514\u2500\u2500 Stop Hooks: Final gate BEFORE completion                \u2502\n\u2502      \u2514\u2500\u2500 Coverage validator: Can't stop without 80%          \u2502\n\u2502                                                              \u2502\n\u2502  Result: Agent keeps working until ALL gates pass            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n### Two Layers of Validation\n\n| Layer | Purpose | Validators |\n|-------|---------|------------|\n| **Plan Validation** | Ensure plans have required structure | `validate_new_file.py`, `validate_file_contains.py` |\n| **Code Quality** | Ensure code meets engineering standards | `tdd_enforcer.py`, `oxlint_validator.py`, `tsc_validator.py`, `coverage_validator.py` |\n\n**Plan validators** ensure the orchestrating agent creates well-formed plans with required sections.\n**Code quality validators** ensure builder agents produce production-ready code.\n\n### Why This Matters\n\n> \"You want to be teaching your agents how to build like you would.\"\n\nThe difference between **agentic engineering** and **vibe coding** is knowing the outcome your agent will generate. Self-validating agents with templated plans create predictable, high-quality results.\n\n---\n\n## Hook Validators\n\n### TDD Enforcer (`tdd_enforcer.py`)\n**Event**: PreToolUse (Write|Edit|MultiEdit)\n\nBlocks implementation file writes until corresponding test file has been modified in the session.\n\n```python\n# Patterns matched as test files:\nsrc/foo.ts        \u2192 src/foo.test.ts, src/foo.spec.ts\nsrc/bar/Baz.tsx   \u2192 src/bar/Baz.test.tsx, src/bar/__tests__/Baz.test.tsx\n```\n\n### Session Start TDD (`session_start_tdd.py`)\n**Event**: SessionStart\n\nClears TDD session state, ensuring each session starts fresh.\n\n### OXLint Validator (`oxlint_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `pnpm exec oxlint` on TS/JS files. Blocks if lint errors found.\n\n### TSC Validator (`tsc_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nRuns `npx tsc --noEmit` on TypeScript files. Blocks if type errors found.\n\n### Coverage Validator (`coverage_validator.py`)\n**Event**: Stop\n\nRuns `pnpm test:coverage` and blocks if coverage < 80%.\n\n### Storybook Validator (`storybook_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nChecks if new React components have corresponding Storybook stories. Provides warning (or blocks in strict mode) if stories are missing.\n\n### Test Methodology Validator (`test_methodology_validator.py`)\n**Event**: PostToolUse (Write|Edit)\n\nValidates proper test separation between unit tests and interaction tests:\n- Unit tests (`.test.tsx`) for structure/rendering\n- Storybook play functions for user interactions\n\nWarns if story files lack play functions or if unit test files are missing.\n\n---\n\n## Testing Methodology\n\nA critical distinction for UI agents: **unit tests** and **interaction tests** serve different purposes and use different tools.\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  UNIT TESTS (.test.tsx / .test.ts)                          \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test component STRUCTURE and RENDERING        \u2502\n\u2502  \u251c\u2500\u2500 Tool: Vitest + Testing Library                         \u2502\n\u2502  \u251c\u2500\u2500 Environment: jsdom (fast, limited)                     \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Renders without errors                             \u2502\n\u2502      \u251c\u2500\u2500 Props applied correctly                            \u2502\n\u2502      \u251c\u2500\u2500 Variant classes present                            \u2502\n\u2502      \u2514\u2500\u2500 Accessibility attributes (roles, aria-*)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  STORYBOOK INTERACTION TESTS (play functions)               \u2502\n\u2502  \u251c\u2500\u2500 Purpose: Test USER INTERACTIONS in real browser        \u2502\n\u2502  \u251c\u2500\u2500 Tool: storybook/test (userEvent, within, expect)       \u2502\n\u2502  \u251c\u2500\u2500 Environment: Real browser via Playwright               \u2502\n\u2502  \u2514\u2500\u2500 Tests:                                                 \u2502\n\u2502      \u251c\u2500\u2500 Click interactions                                 \u2502\n\u2502      \u251c\u2500\u2500 Keyboard navigation                                \u2502\n\u2502      \u251c\u2500\u2500 Focus management                                   \u2502\n\u2502      \u2514\u2500\u2500 State changes (expanded, selected, etc.)           \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n**Why This Matters**: Unit tests run in jsdom which has limitations with real browser behavior. Storybook play functions run in a REAL BROWSER via Playwright, catching issues unit tests miss.\n\n### Test File Mapping\n\n| Test Type | File Pattern | What to Test |\n|-----------|--------------|--------------|\n| Unit | `Component.test.tsx` | Rendering, classes, props, DOM structure |\n| Interaction | `Component.stories.tsx` (play) | Clicks, keyboard, focus, state changes |\n\n---\n\n## UI Agents\n\nThe UI layer provides specialized agents for frontend development with design system knowledge.\n\n### User-Level UI Agents\n\n| Agent | Purpose |\n|-------|---------|\n| `ui-builder` | Generic React + Tailwind builder with Motion |\n| `ui-validator` | Read-only validation against design specs |\n\n### Project-Level UI Agents\n\n| Project | Agent | Stack |\n|---------|-------|-------|\n| Stached | `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |\n| Oculis | `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |\n\n### UI Validation Flow\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  1. PLANNING: Include design specs in task prompts          \u2502\n\u2502     - Reference component patterns                          \u2502\n\u2502     - Specify animation requirements                        \u2502\n\u2502     - Include accessibility criteria                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  2. BUILD: UI builder creates component                     \u2502\n\u2502     - PostToolUse: lint, types, storybook check             \u2502\n\u2502     - Creates component + stories + tests                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2193\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  3. VALIDATE: UI validator reviews implementation           \u2502\n\u2502     - Design compliance                                     \u2502\n\u2502     - Accessibility (WCAG AA)                               \u2502\n\u2502     - Component patterns                                    \u2502\n\u2502     - Flags issues for self-correction                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n```\n\n---\n\n## Shared Agents\n\n### `tdd-builder`\n**Model**: opus | **Color**: cyan\n\nThe flagship self-validating agent with all gates:\n- PreToolUse: TDD enforcement\n- PostToolUse: Lint + Type validation\n- Stop: Coverage threshold\n\nUse for disciplined TDD workflow.\n\n### `ts-builder`\n**Model**: opus | **Color**: blue\n\nStandard builder with quality validation:\n- PostToolUse: Lint + Type validation\n\nUse for general implementation without strict TDD.\n\n### `ts-validator`\n**Model**: sonnet | **Color**: yellow\n\nRead-only verification agent:\n- Disallowed: Write, Edit, MultiEdit, NotebookEdit\n\nUse after builder to verify work meets standards.\n\n### `turborepo-runner`\n**Model**: sonnet | **Color**: green\n\nMonorepo orchestration specialist:\n- Tools: Bash, Read, Glob\n\nUse for running commands across monorepo packages.\n\n### `coverage-checker`\n**Model**: haiku | **Color**: purple\n\nLightweight coverage validation:\n- Disallowed: Write, Edit\n\nUse to check coverage after tests pass.\n\n---\n\n## Project Agents\n\n### Stached\n\n| Agent | Purpose |\n|-------|---------|\n| `convex-builder` | Convex backend with type-check gate |\n| `article-parser` | Mozilla Readability, HTML sanitization |\n| `extension-builder` | WXT framework, Manifest V3 |\n\n### Oculis\n\n| Agent | Purpose |\n|-------|---------|\n| `axe-specialist` | WCAG compliance, axe-core |\n| `adapter-guide` | DI/Adapter architecture (read-only) |\n| `tdd-builder` | TDD with Turborepo validation |\n\n---\n\n## Usage\n\n### Invoking Agents via Task Tool\n\n```typescript\nTask({\n  description: \"Implement feature with TDD\",\n  prompt: \"Create user authentication with tests first\",\n  subagent_type: \"tdd-builder\",\n  model: \"opus\"\n})\n```\n\n### Orchestrating Multiple Agents\n\nSee [Writing Agent Plans](docs/writing-agent-plans.md) for the complete orchestration format.\n\n```markdown\n## Team Members\n\n- Builder\n  - Name: auth-builder\n  - Role: Implement authentication\n  - Agent Type: tdd-builder\n  - Resume: true\n\n- Validator\n  - Name: auth-validator\n  - Role: Verify auth implementation\n  - Agent Type: ts-validator\n  - Resume: true\n```\n\n---\n\n## Creating New Agents\n\n### Agent Definition Format\n\n```yaml\n---\nname: my-agent\ndescription: Action-oriented description for auto-delegation\nmodel: opus | sonnet | haiku\ncolor: red | blue | green | yellow | purple | orange | pink | cyan\ntools: Tool1, Tool2        # Optional: restrict tools\ndisallowedTools: Write     # Optional: deny tools\nhooks:\n  PreToolUse:\n    - matcher: \"Write|Edit\"\n      hooks:\n        - type: command\n          command: uv run ~/.claude/hooks/validators/my_validator.py\n  PostToolUse:\n    - matcher: \"Write\"\n      hooks:\n        - type: command\n          command: pnpm lint\n  Stop:\n    - hooks:\n        - type: command\n          command: pnpm test\n---\n\n# Agent Name\n\n## Purpose\nWhat this agent does and when to use it.\n\n## Instructions\nHow the agent should operate.\n\n## Report\nOutput format when task completes.\n```\n\n### Hook Output Format\n\nHooks must output JSON:\n\n```json\n// Allow the action\n{\"decision\": \"allow\"}\n\n// Block the action\n{\"decision\": \"block\", \"reason\": \"Explanation of why blocked\"}\n```\n\n---\n\n## Testing\n\n### Verify TDD Enforcer\n\n```bash\n# Should block (no test exists)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (it's a test file)\necho '{\"tool_input\": {\"file_path\": \"src/foo.test.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n\n# Should allow (test was recorded)\necho '{\"tool_input\": {\"file_path\": \"src/foo.ts\"}}' | python3 ~/.claude/hooks/validators/tdd_enforcer.py\n```\n\n### Reset TDD State\n\n```bash\npython3 ~/.claude/hooks/validators/session_start_tdd.py\n```\n\n### Validate Python Syntax\n\n```bash\npython3 -m py_compile ~/.claude/hooks/validators/*.py\n```\n",
      "structuredPatch": [
        {
          "oldStart": 315,
          "oldLines": 6,
          "newStart": 315,
          "newLines": 7,
          "lines": [
            " | `convex-builder` | Convex backend with type-check gate |",
            " | `article-parser` | Mozilla Readability, HTML sanitization |",
            " | `extension-builder` | WXT framework, Manifest V3 |",
            "+| `shadcn-builder` | ShadCN/UI + Tailwind v4 + Framer Motion |",
            " ",
            " ### Oculis",
            " "
          ]
        },
        {
          "oldStart": 323,
          "oldLines": 6,
          "newStart": 324,
          "newLines": 7,
          "lines": [
            " | `axe-specialist` | WCAG compliance, axe-core |",
            " | `adapter-guide` | DI/Adapter architecture (read-only) |",
            " | `tdd-builder` | TDD with Turborepo validation |",
            "+| `nuxt-ui-builder` | NuxtUI + Tailwind + Motion-vue |",
            " ",
            " ---",
            " "
          ]
        }
      ],
      "userModified": false,
      "replaceAll": false
    },
    "tool_use_id": "toolu_01JKyxV3XQXqtKpXrUvwpQFe"
  }
]